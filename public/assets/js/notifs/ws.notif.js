// Generated by CoffeeScript 1.12.5

/*
WebSocket Notification class.
Refer to layout view:
<span id="notif">
  <input type="hidden" class="host" value="ws://localhost:8080" />
  <input type="hidden" class="topic" value="projects" />
</span>
 */

(function() {
  this.WsNotif = (function() {
    function WsNotif(wsUri, topicUri) {
      this.topicUri = topicUri;
      this.conn = new ab.Session(wsUri, this.onSessOpen, this.onSessClose, {
        'skipSubprotocolCheck': true
      });
    }

    WsNotif.prototype.onSub = function(topic, data) {
      if (Notify.isSupported()) {
        return Notify.requestPermission(this.onPermGranted, this.onPermDenied);
      } else {
        return new Notify(topic, {
          body: data.message
        }).show();
      }
    };

    WsNotif.prototype.onSessOpen = function() {
      return this.conn.subscribe(this.topicUri, this.onSub);
    };

    WsNotif.prototype.onSessClose = function() {
      return console.warn('WebSocket connection closed.');
    };

    WsNotif.prototype.onPermGranted = function() {};

    WsNotif.prototype.onPermDenied = function() {};

    return WsNotif;

  })();

  $(document).ready(function() {
    return new WsNotif($('#notif .host').val(), $('#notif .topic').val());
  });

}).call(this);
